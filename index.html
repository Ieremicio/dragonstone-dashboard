<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dragonstone Hospital - Operations Analysis Dashboard">
    <title>Blocco Operatorio Dragonstone - Dashboard Completa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Mobile Optimization */
        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-container {
                padding: 15px;
                margin: 5px;
            }
        }

        /* ==========================================
        DASHBOARD DRAGONSTONE - CSS UNIFICATO
        ========================================== */

        /* BASE RESET */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
        }

        /* ==========================================
        NAVIGATION STYLES
        ========================================== */
        .main-nav {
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 20px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border-bottom: 3px solid #3498db;
        }

        .nav-brand {
            color: white;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: transparent;
            color: white;
            border: 2px solid #34495e;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-button:hover {
            background: #3498db;
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .nav-button.active {
            background: #e74c3c;
            border-color: #e74c3c;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        /* ==========================================
        SECTION LAYOUT
        ========================================== */
        .dashboard-section {
            display: none;
            padding: 20px;
            min-height: calc(100vh - 120px);
        }

        .dashboard-section.active {
            display: block;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        /* ==========================================
        HEADERS & TITLES
        ========================================== */
        .header {
            text-align: center;
            margin-bottom: 50px;
            border-bottom: 4px solid #2c3e50;
            padding-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header .subtitle {
            color: #e74c3c;
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header .date {
            color: #7f8c8d;
            font-size: 1em;
            font-style: italic;
        }

        .section-title {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 25px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ==========================================
        SECTION CONTAINERS
        ========================================== */
        .section {
            margin-bottom: 50px;
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left: 6px solid var(--section-color, #3498db);
        }

        .section.timing { --section-color: #e74c3c; }
        .section.infrastructure { --section-color: #f39c12; }
        .section.specialita { --section-color: #9b59b6; }
        .section.recommendations { --section-color: #27ae60; }

        /* ==========================================
        ALERT BOXES
        ========================================== */
        .crisis-alert, .critical-alert, .mapping-alert, .critical-findings {
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(231, 76, 60, 0.3);
            border: 3px solid #c0392b;
        }

        .crisis-alert {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .critical-alert {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .mapping-alert {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 10px 25px rgba(243, 156, 18, 0.3);
        }

        .critical-findings {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            box-shadow: 0 10px 25px rgba(155, 89, 182, 0.3);
        }

        .crisis-alert h2, .critical-alert h2, .mapping-alert h2, .critical-findings h2 {
            font-size: 2.2em;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ==========================================
        STATS & METRICS GRIDS
        ========================================== */
        .crisis-stats, .stats, .findings-grid, .mapping-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .crisis-stat, .critical-stat, .finding-card, .mapping-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .crisis-stat .value, .critical-stat .value, .finding-value, .mapping-card .number {
            font-size: 2.8em;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .crisis-stat .label, .critical-stat .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* ==========================================
        KPI CARDS
        ========================================== */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .kpi-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ==========================================
        PROBLEMS & INSIGHTS GRIDS
        ========================================== */
        .problems-grid, .insights-grid, .anomalie-list, .specialita-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .problem-card, .insight-card, .anomalia-card, .specialita-card {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--urgency-color, #3498db);
            position: relative;
        }

        .problem-card.critica, .specialita-card.alta-priorita { --urgency-color: #e74c3c; }
        .problem-card.alta, .specialita-card.media-priorita { --urgency-color: #f39c12; }
        .problem-card.media, .specialita-card.bassa-priorita { --urgency-color: #3498db; }

        .urgency-badge, .priority-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .urgency-critica, .priority-alta { background: #f8d7da; color: #721c24; }
        .urgency-alta, .priority-media { background: #fff3cd; color: #856404; }
        .urgency-media, .priority-bassa { background: #cce5ff; color: #004085; }

        .problem-title, .insight-title, .anomalia-title, .specialita-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 12px;
        }

        .problem-description, .insight-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .impact-metric {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* ==========================================
        INSIGHT CARDS SPECIFIC
        ========================================== */
        .insight-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }

        .insight-card.critical {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .insight-card.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .insight-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        /* Fix text color in insight cards */
        .insight-card .insight-title,
        .insight-card .insight-description {
            color: white !important;
        }

        /* ==========================================
        ANOMALIE CARDS
        ========================================== */
        .anomalia-card {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-left: 5px solid #e53e3e;
        }

        .anomalia-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
        }

        /* ==========================================
        CHARTS CONTAINERS - FIXED DIMENSIONS
        ========================================== */
        .chart-grid, .timing-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            width: 100%;
            max-width: 600px;
            position: relative;
        }

        .chart-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            width: 100%;
            max-width: 600px;
            position: relative;
        }

        .chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* ==========================================
        TABLES
        ========================================== */
        .specialita-table, .mobility-table, .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .specialita-table th, .mobility-table th, .benchmark-table th,
        .specialita-table td, .mobility-table td, .benchmark-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .specialita-table th, .mobility-table th, .benchmark-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .percentage-bar {
            background: #ecf0f1;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-top: 5px;
        }

        .percentage-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* ==========================================
        SPECIALIT√Ä TIMING TABLE
        ========================================== */
        .specialita-timing {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .specialita-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            align-items: center;
        }

        .specialita-row:nth-child(even) {
            background: #f8f9fa;
        }

        .specialita-row.header {
            background: #2c3e50;
            color: white;
            font-weight: 600;
        }

        /* ==========================================
        BADGES & INDICATORS
        ========================================== */
        .timing-badge, .mobility-badge, .sala-badge, .utilization-badge {
            padding: 5px 15px;
            border-radius: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
            display: inline-block;
        }

        .timing-good, .mobility-bassa { background: #d4edda; color: #155724; }
        .timing-warning, .mobility-media { background: #fff3cd; color: #856404; }
        .timing-danger, .mobility-alta { background: #f8d7da; color: #721c24; }

        .badge-dedicata { background: #d4edda; color: #155724; }
        .badge-prevalente { background: #fff3cd; color: #856404; }
        .badge-condivisa { background: #cce5ff; color: #004085; }

        .util-alta { background: #f8d7da; color: #721c24; }
        .util-media { background: #fff3cd; color: #856404; }
        .util-bassa { background: #d1ecf1; color: #0c5460; }

        /* ==========================================
        WEEKLY PATTERNS
        ========================================== */
        .weekly-pattern, .weekly-heatmap {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .weekly-heatmap {
            grid-template-columns: repeat(6, 1fr);
        }

        .day-card, .heatmap-cell {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .day-card.problema {
            border-left-color: #e74c3c;
            background: #fff5f5;
        }

        .day-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .day-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .day-stat {
            font-size: 0.9em;
            color: #666;
        }

        .day-stat .value {
            font-weight: 600;
            color: #2c3e50;
        }

        .heatmap-cell {
            padding: 10px;
            font-size: 0.85em;
        }

        .heatmap-header {
            background: #2c3e50;
            color: white;
            font-weight: 600;
        }

        .heatmap-low { background: #d4edda; color: #155724; }
        .heatmap-medium { background: #fff3cd; color: #856404; }
        .heatmap-high { background: #f8d7da; color: #721c24; }

        /* ==========================================
        INFRASTRUCTURE SPECIFIC
        ========================================== */
        .capacity-summary, .sale-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .capacity-card, .sala-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .sala-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--accent-color, #3498db);
        }

        .sala-card.alta { --accent-color: #e74c3c; }
        .sala-card.media { --accent-color: #f39c12; }
        .sala-card.bassa { --accent-color: #95a5a6; }

        .capacity-value, .sala-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .capacity-label {
            color: #666;
            font-size: 0.9em;
        }

        .sala-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sala-stat {
            font-size: 0.9em;
            color: #666;
        }

        .sala-stat .value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* ==========================================
        SPECIALIT√Ä METRICS
        ========================================== */
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.8em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .problemi-list {
            margin-bottom: 15px;
        }

        .problema-tag {
            display: inline-block;
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin: 2px;
        }

        .opportunita-tag {
            display: inline-block;
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin: 2px;
        }

        .performance-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .perf-excellent { background: #27ae60; }
        .perf-good { background: #f39c12; }
        .perf-poor { background: #e74c3c; }

        /* ==========================================
        DATA QUALITY
        ========================================== */
        .quality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .quality-item {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .quality-percentage {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .quality-good { color: #27ae60; }
        .quality-warning { color: #f39c12; }
        .quality-poor { color: #e74c3c; }

        /* ==========================================
        ROI & RECOMMENDATIONS
        ========================================== */
        .roi-section {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 15px;
            padding: 35px;
            margin-bottom: 40px;
        }

        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .roi-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .roi-value {
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .roi-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .recommendations-timeline {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .recommendation-item {
            display: grid;
            grid-template-columns: 60px 1fr 120px 120px;
            gap: 20px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 6px solid var(--priority-color);
            align-items: center;
        }

        .recommendation-item.priority-1 { --priority-color: #e74c3c; }
        .recommendation-item.priority-2 { --priority-color: #f39c12; }
        .recommendation-item.priority-3 { --priority-color: #f1c40f; }
        .recommendation-item.priority-4 { --priority-color: #3498db; }
        .recommendation-item.priority-5 { --priority-color: #9b59b6; }

        .priority-number {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--priority-color);
            text-align: center;
        }

        .recommendation-content h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .recommendation-content p {
            color: #666;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .benefit-tag {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .timeline-badge {
            background: #e3f2fd;
            color: #1565c0;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-align: center;
        }

        .cost-badge {
            background: #fff3e0;
            color: #ef6c00;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-align: center;
        }

        /* ==========================================
        SUCCESS METRICS
        ========================================== */
        .success-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .metric-category {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-top: 4px solid var(--category-color);
        }

        .metric-category.timing-metrics { --category-color: #e74c3c; }
        .metric-category.capacity-metrics { --category-color: #f39c12; }
        .metric-category.specialita-metrics { --category-color: #9b59b6; }
        .metric-category.sistema-metrics { --category-color: #27ae60; }

        .metric-category h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .metric-list {
            list-style: none;
        }

        .metric-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            color: #666;
            font-size: 0.9em;
        }

        .metric-list li:last-child {
            border-bottom: none;
        }

        /* ==========================================
        FOOTER CTA
        ========================================== */
        .footer-cta {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-top: 40px;
        }

        .footer-cta h2 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .footer-cta p {
            font-size: 1.2em;
            opacity: 0.9;
            line-height: 1.6;
        }

        /* ==========================================
        RESPONSIVE DESIGN
        ========================================== */
        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 200px;
                margin: 5px 0;
            }
            
            .dashboard-container {
                margin: 10px;
                padding: 20px;
            }
            
            .chart-grid, .timing-grid {
                grid-template-columns: 1fr;
            }
            
            .recommendation-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .weekly-pattern {
                grid-template-columns: 1fr;
            }
            
            .weekly-heatmap {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section-title {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- ==========================================
         NAVIGATION MENU
         ========================================== -->
    <nav class="main-nav">
        <div class="nav-brand">üè• Blocco Operatorio Dragonstone</div>
        <div class="nav-buttons">
            <button class="nav-button active" onclick="showSection('executive')">Executive Summary</button>
            <button class="nav-button" onclick="showSection('overview')">Overview & Data Quality</button>
            <button class="nav-button" onclick="showSection('timing')">Timing Analysis</button>
            <button class="nav-button" onclick="showSection('infrastructure')">Infrastructure</button>
            <button class="nav-button" onclick="showSection('specialita')">Specialit√† Analysis</button>
        </div>
    </nav>

    <!-- ==========================================
         SEZIONE 1: EXECUTIVE SUMMARY
         ========================================== -->
    <div id="executive" class="dashboard-section active">
        <div class="dashboard-container">
            <div class="header">
                <h1>üè• Executive Summary</h1>
                <div class="subtitle">BLOCCO OPERATORIO DRAGONSTONE - ANALYSIS & RECOMMENDATIONS</div>
                <div class="date">Analisi Operativa | Giugno 2025 | MIMS Group Consultation</div>
            </div>
            
            <!-- Crisis Alert -->
            <div class="crisis-alert">
                <h2>‚ö†Ô∏è SISTEMA IN STRESS OPERATIVO CRITICO</h2>
                <p style="font-size: 1.2em; margin-bottom: 20px;">
                    Analisi dei dati operativi rivela inefficienze sistemiche con impatto significativo su produttivit√† e qualit√† assistenziale
                </p>
                <div class="crisis-stats">
                    <div class="crisis-stat">
                        <div class="value">95%</div>
                        <div class="label">Primi interventi<br>in ritardo</div>
                    </div>
                    <div class="crisis-stat">
                        <div class="value">2h</div>
                        <div class="label">Tempo produttivo<br>perso/giorno</div>
                    </div>
                    <div class="crisis-stat">
                        <div class="value">44%</div>
                        <div class="label">Utilizzo medio sale<br>(vs 75% target)</div>
                    </div>
                    <div class="crisis-stat">
                        <div class="value">76%</div>
                        <div class="label">Variabilit√† UROLOGIA<br>(vs 30% target)</div>
                    </div>
                </div>
            </div>
            
            <!-- Problemi Sistemici -->
            <div class="section timing">
                <h2 class="section-title">üö® Problemi Sistemici Identificati</h2>
                <div class="problems-grid">
                    <div class="problem-card critica">
                        <div class="urgency-badge urgency-critica">CRITICA</div>
                        <div class="problem-title">TIMING SISTEMICO</div>
                        <div class="problem-description">
                            95% dei primi interventi inizia in ritardo rispetto alla programmazione 8:00. 
                            Sistema di scheduling completamente inefficace.
                        </div>
                        <div class="impact-metric">
                            üí• IMPATTO: 98 minuti persi ogni giorno
                        </div>
                    </div>
                    
                    <div class="problem-card alta">
                        <div class="urgency-badge urgency-alta">ALTA</div>
                        <div class="problem-title">INFRASTRUCTURE CHAOS</div>
                        <div class="problem-description">
                            3 sale "fantasma" non documentate + squilibrio estremo: Sala 4 sovraccarica (103%) 
                            mentre Sala 8 quasi inutilizzata (1%).
                        </div>
                        <div class="impact-metric">
                            üìä IMPATTO: 44% utilizzo vs 75% target - 40% capacity sprecata
                        </div>
                    </div>
                    
                    <div class="problem-card alta">
                        <div class="urgency-badge urgency-alta">ALTA</div>
                        <div class="problem-title">SPECIALIT√Ä FRAMMENTATE</div>
                        <div class="problem-description">
                            4/5 specialit√† con variabilit√† >50% CV. CHIRURGIA dispersa su 6 sale diverse. 
                            Solo ORL ha sala dedicata.
                        </div>
                        <div class="impact-metric">
                            üîÄ IMPATTO: Coordinamento esponenzialmente complesso
                        </div>
                    </div>
                    
                    <div class="problem-card media">
                        <div class="urgency-badge urgency-media">MEDIA</div>
                        <div class="problem-title">DATA QUALITY</div>
                        <div class="problem-description">
                            69% dei dati tempo anestesia mancanti. Sistema di raccolta dati incompleto 
                            limita analisi efficienza dettagliate.
                        </div>
                        <div class="impact-metric">
                            üìã IMPATTO: Analisi performance limitate
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ROI Analysis -->
            <div class="roi-section">
                <h2 style="font-size: 2em; margin-bottom: 15px; text-align: center;">üí∞ ROI & IMPACT ANALYSIS</h2>
                <p style="text-align: center; font-size: 1.2em; opacity: 0.9;">
                    Investimento principalmente organizzativo con ritorno rapido e misurabile
                </p>
                <div class="roi-grid">
                    <div class="roi-card">
                        <div class="roi-value">+40%</div>
                        <div class="roi-label">Capacity boost<br>senza nuove risorse</div>
                    </div>
                    <div class="roi-card">
                        <div class="roi-value">2+ ore</div>
                        <div class="roi-label">Tempo produttivo<br>recuperabile/giorno</div>
                    </div>
                    <div class="roi-card">
                        <div class="roi-value">3-6 mesi</div>
                        <div class="roi-label">Payback period<br>investimento</div>
                    </div>
                    <div class="roi-card">
                        <div class="roi-value">BASSO</div>
                        <div class="roi-label">Risk level<br>implementazione</div>
                    </div>
                </div>
            </div>
            
            <!-- Raccomandazioni Prioritarie -->
            <div class="section recommendations">
                <h2 class="section-title">üéØ Raccomandazioni Prioritarie</h2>
                <div class="recommendations-timeline">
                    <div class="recommendation-item priority-1">
                        <div class="priority-number">1</div>
                        <div class="recommendation-content">
                            <h3>TIMING SISTEMICO</h3>
                            <p>Riprogrammazione orari inizio da 8:00 a 9:00-9:30 per allinearsi alla realt√† operativa</p>
                            <span class="benefit-tag">Elimina 95% ritardi + recupera 98min/giorno</span>
                        </div>
                        <div class="timeline-badge">1-2 settimane</div>
                        <div class="cost-badge">NULLO</div>
                    </div>
                    
                    <div class="recommendation-item priority-2">
                        <div class="priority-number">2</div>
                        <div class="recommendation-content">
                            <h3>INFRASTRUCTURE REBALANCING</h3>
                            <p>Redistribuzione carico da Sala 4 (103%) verso sale sottoutilizzate</p>
                            <span class="benefit-tag">Ottimizza capacity + riduce stress operativo</span>
                        </div>
                        <div class="timeline-badge">1 mese</div>
                        <div class="cost-badge">BASSO</div>
                    </div>
                    
                    <div class="recommendation-item priority-3">
                        <div class="priority-number">3</div>
                        <div class="recommendation-content">
                            <h3>SPECIALIT√Ä CONSOLIDAMENTO</h3>
                            <p>CHIRURGIA: riduzione da 6 a 2-3 sale dedicate + gestione tasso urgenze</p>
                            <span class="benefit-tag">Riduce frammentazione + migliora coordinamento</span>
                        </div>
                        <div class="timeline-badge">2-3 mesi</div>
                        <div class="cost-badge">MEDIO</div>
                    </div>
                    
                    <div class="recommendation-item priority-4">
                        <div class="priority-number">4</div>
                        <div class="recommendation-content">
                            <h3>TURN-OVER OPTIMIZATION</h3>
                            <p>Team dedicato sanificazione + protocolli standardizzati</p>
                            <span class="benefit-tag">Riduce turn-over da 33 a 20 min target</span>
                        </div>
                        <div class="timeline-badge">3-4 settimane</div>
                        <div class="cost-badge">MEDIO</div>
                    </div>
                    
                    <div class="recommendation-item priority-5">
                        <div class="priority-number">5</div>
                        <div class="recommendation-content">
                            <h3>STANDARDIZZAZIONE SPECIALIT√Ä</h3>
                            <p>Protocolli tempi UROLOGIA per ridurre variabilit√† da 76% a <40%</p>
                            <span class="benefit-tag">Programmazione accurata + prevedibilit√†</span>
                        </div>
                        <div class="timeline-badge">2-4 mesi</div>
                        <div class="cost-badge">BASSO</div>
                    </div>
                </div>
            </div>
            
            <!-- Success Metrics -->
            <div class="section">
                <h2 class="section-title">üìà Metriche di Success</h2>
                <div class="success-metrics">
                    <div class="metric-category timing-metrics">
                        <h4>üïê TIMING</h4>
                        <ul class="metric-list">
                            <li>% primi interventi in orario (target: >80%)</li>
                            <li>Ritardo medio primo intervento (target: <30min)</li>
                            <li>Turn-over medio (target: 20¬±5min)</li>
                        </ul>
                    </div>
                    
                    <div class="metric-category capacity-metrics">
                        <h4>üèóÔ∏è CAPACITY</h4>
                        <ul class="metric-list">
                            <li>Utilizzo medio sale (target: 70-80%)</li>
                            <li>Bilanciamento carico (max sala <90%)</li>
                            <li>N¬∞ sale attive documentate</li>
                        </ul>
                    </div>
                    
                    <div class="metric-category specialita-metrics">
                        <h4>üè• SPECIALIT√Ä</h4>
                        <ul class="metric-list">
                            <li>CV medio specialit√† (target: <40%)</li>
                            <li>N¬∞ sale per specialit√† (target: ‚â§3)</li>
                            <li>% urgenze per specialit√† (monitoring)</li>
                        </ul>
                    </div>
                    
                    <div class="metric-category sistema-metrics">
                        <h4>‚öôÔ∏è SISTEMA</h4>
                        <ul class="metric-list">
                            <li>Data quality score (target: >90%)</li>
                            <li>Coordinamento score (survey staff)</li>
                            <li>Tempo ciclo paziente (end-to-end)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Implementation Timeline Chart -->
            <div class="section">
                <h2 class="section-title">üìÖ Timeline Implementazione</h2>
                <div class="chart-container">
                    <canvas id="execTimelineChart"></canvas>
                </div>
            </div>
            
            <!-- Best Practices -->
            <div class="section">
                <h2 class="section-title">üèÜ Best Practices Identificate</h2>
                <div class="problems-grid">
                    <div class="problem-card" style="border-left-color: #27ae60;">
                        <div class="problem-title" style="color: #27ae60;">MODELLO ORL</div>
                        <div class="problem-description">
                            <strong>Sala dedicata + programmazione stabile</strong><br>
                            100% concentrazione su Sala 2, variabilit√† controllata, scheduling semplificato.
                            Modello replicabile per altre specialit√† ad alto volume.
                        </div>
                        <div class="impact-metric" style="background: #d4edda; color: #155724;">
                            ‚úÖ BENEFICI: Coordinamento ottimale + efficienza 100%
                        </div>
                    </div>
                    
                    <div class="problem-card" style="border-left-color: #27ae60;">
                        <div class="problem-title" style="color: #27ae60;">VARIABILIT√Ä ORTOPEDIA</div>
                        <div class="problem-description">
                            <strong>CV 42% vs 76% UROLOGIA</strong><br>
                            Migliore standardizzazione protocolli risulta in tempi pi√π prevedibili. 
                            Approach replicabile per ridurre variabilit√† sistemica.
                        </div>
                        <div class="impact-metric" style="background: #d4edda; color: #155724;">
                            ‚úÖ BENEFICI: Programmazione accurata + prevedibilit√†
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Next Steps -->
            <div class="footer-cta">
                <h2>üöÄ NEXT STEPS IMMEDIATI</h2>
                <p>
                    <strong>RACCOMANDAZIONE:</strong> Implementazione immediata delle prime 3 priorit√† per massimizzare impact nel breve termine.<br><br>
                    
                    <strong>FASE 1 (1-4 settimane):</strong> Timing sistemico + Infrastructure rebalancing<br>
                    <strong>FASE 2 (1-3 mesi):</strong> Specialit√† consolidamento + Turn-over optimization<br>
                    <strong>FASE 3 (2-4 mesi):</strong> Standardizzazione specialit√† + Success metrics tracking<br><br>
                    
                    <strong>ROI ATTESO:</strong> 40% capacity boost + 2 ore produttive/giorno con payback 3-6 mesi
                </p>
            </div>
        </div>
    </div>

    <!-- ==========================================
         SEZIONE 2: OVERVIEW & DATA QUALITY
         ========================================== -->
    <div id="overview" class="dashboard-section">
        <div class="dashboard-container">
            <div class="header">
                <h1>üè• Blocco Operatorio Dragonstone</h1>
                <div class="subtitle">Executive Overview & Data Quality Assessment</div>
            </div>
            
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value">455</div>
                    <div class="kpi-label">Totale Interventi</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">35</div>
                    <div class="kpi-label">Giorni Analisi</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">10</div>
                    <div class="kpi-label">Sale Operative</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">5</div>
                    <div class="kpi-label">Specialit√†</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">91</div>
                    <div class="kpi-label">Min Medi Intervento</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">13</div>
                    <div class="kpi-label">Interventi/Giorno</div>
                </div>
            </div>
            
            <!-- Data Quality Section -->
            <div class="section">
                <h2 class="section-title">üìä Data Quality Assessment</h2>
                <div class="quality-grid">
                    <div class="quality-item">
                        <div class="quality-percentage quality-good">100%</div>
                        <div>Tempi Intervento</div>
                    </div>
                    <div class="quality-item">
                        <div class="quality-percentage quality-poor">31%</div>
                        <div>Tempi Anestesia</div>
                    </div>
                    <div class="quality-item">
                        <div class="quality-percentage quality-good">100%</div>
                        <div>Orari Sala</div>
                    </div>
                </div>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <strong>‚ö†Ô∏è Alert:</strong> 69% dei dati di tempo anestesia mancanti - questo limita alcune analisi di efficienza
                </div>
            </div>
            
            <!-- Specialit√† Performance -->
            <div class="section">
                <h2 class="section-title">üè• Performance per Specialit√†</h2>
                <table class="specialita-table">
                    <thead>
                        <tr>
                            <th>Specialit√†</th>
                            <th>N¬∞ Interventi</th>
                            <th>% del Totale</th>
                            <th>Tempo Medio (min)</th>
                            <th>Distribuzione</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>UROLOGIA</strong></td>
                            <td>156</td>
                            <td>34%</td>
                            <td>91</td>
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: 34%"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>ORTOPEDIA E TRAUMATOLOGIA</strong></td>
                            <td>104</td>
                            <td>23%</td>
                            <td>101</td>
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: 23%"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>OSTETRICIA E GINECOLOGIA</strong></td>
                            <td>83</td>
                            <td>18%</td>
                            <td>81</td>
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: 18%"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>CHIRURGIA GENERALE</strong></td>
                            <td>73</td>
                            <td>16%</td>
                            <td>91</td>
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: 16%"></div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>OTORINOLARINGOIATRIA</strong></td>
                            <td>39</td>
                            <td>9%</td>
                            <td>82</td>
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: 9%"></div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Charts Section -->
            <div class="section">
                <h2 class="section-title">üìà Distribuzione Interventi</h2>
                <div class="chart-grid">
                    <div class="chart-box">
                        <canvas id="overviewSpecialitaChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <canvas id="overviewTipoInterventoChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Anomalie Section -->
            <div class="section">
                <h2 class="section-title">‚ö†Ô∏è Anomalie Rilevate</h2>
                <div class="anomalie-list">
                    <div class="anomalia-card">
                        <div class="anomalia-title">Sale Extra</div>
                        <div class="anomalia-value">3 sale</div>
                        <div style="margin-top: 10px; color: #666;">Sale 8, 9, 11 non documentate nel caso (teoriche: 1-7)</div>
                    </div>
                    <div class="anomalia-card">
                        <div class="anomalia-title">Operazioni Weekend</div>
                        <div class="anomalia-value">12 interventi</div>
                        <div style="margin-top: 10px; color: #666;">Solo 2.6% del volume totale nel weekend</div>
                    </div>
                    <div class="anomalia-card">
                        <div class="anomalia-title">Dati Anestesia Mancanti</div>
                        <div class="anomalia-value">69%</div>
                        <div style="margin-top: 10px; color: #666;">314 su 455 record senza tempo anestesia</div>
                    </div>
                    <div class="anomalia-card">
                        <div class="anomalia-title">Tasso Urgenze</div>
                        <div class="anomalia-value">11%</div>
                        <div style="margin-top: 10px; color: #666;">Da verificare se coerente con le "false urgenze" del caso</div>
                    </div>
                </div>
            </div>

            <!-- Analisi Approfondita Dataset -->
            <div class="section">
                <h2 class="section-title">üîç Analisi Approfondita Dataset</h2>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; line-height: 1.6;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">Distribuzione Temporale</h4>
                    <p>L'analisi dei 455 interventi su 35 giorni rivela una distribuzione non uniforme con picchi significativi il gioved√¨ (108 interventi) e una riduzione marcata nel weekend (solo 12 interventi, 2.6%). Il volume medio di 13 interventi/giorno √® concentrato nei giorni feriali con pattern ricorrenti.</p>
                    
                    <h4 style="color: #2c3e50; margin: 20px 0 15px;">Composizione Case Mix</h4>
                    <p>Il 73% degli interventi √® in elezione (331/455), seguiti da urgenze 11% (51) e libera professione 10% (44). Il tasso di urgenze dell'11% richiede validazione rispetto alle "false urgenze" segnalate nel caso, suggerendo possibili inefficienze nel sistema di classificazione.</p>
                    
                    <h4 style="color: #2c3e50; margin: 20px 0 15px;">Efficienza Operativa</h4>
                    <p>Tutte le specialit√† mostrano efficienza >100% (CHIRURGIA 130%, GINECOLOGIA 129%, UROLOGIA 126%), indicando sottostima sistematica dei tempi programmati. Questo paradosso efficienza-ritardi suggerisce problemi nel sistema di scheduling piuttosto che nella performance clinica.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         SEZIONE 3: TIMING ANALYSIS - COMPLETA
         ========================================== -->
    <div id="timing" class="dashboard-section">
        <div class="dashboard-container">
            <div class="header">
                <h1>‚è∞ Timing & Scheduling Analysis</h1>
                <div class="subtitle">CRITICAL ISSUES IDENTIFIED - IMMEDIATE ACTION REQUIRED</div>
            </div>
            
            <!-- Critical Alert -->
            <div class="critical-alert">
                <h2>üö® ALERT CRITICO: Sistema di Scheduling Completamente Compromesso</h2>
                <p>I dati rivelano un collasso sistemico nella puntualit√† delle prime sedute operatorie</p>
                <div class="stats">
                    <div class="critical-stat">
                        <div class="value">95%</div>
                        <div>Primi interventi in ritardo</div>
                    </div>
                    <div class="critical-stat">
                        <div class="value">98 min</div>
                        <div>Ritardo medio dalla programmazione</div>
                    </div>
                    <div class="critical-stat">
                        <div class="value">33 min</div>
                        <div>Turn-over medio tra interventi</div>
                    </div>
                    <div class="critical-stat">
                        <div class="value">138/146</div>
                        <div>Primi interventi oltre le 8:00</div>
                    </div>
                </div>
            </div>
            
            <!-- Timing Analysis -->
            <div class="section">
                <h2 class="section-title">üìä Analisi Dettagliata dei Ritardi</h2>
                <div class="timing-grid">
                    <div class="chart-container">
                        <canvas id="timingRitardiChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="timingOrariChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Analisi Causa-Effetto -->
            <div class="section">
                <h2 class="section-title">üìà Analisi Causa-Effetto Ritardi</h2>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; line-height: 1.6;">
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">Root Cause Analysis</h4>
                    <p><strong>Primo Intervento (8:00 programmato):</strong> Solo 8/146 primi interventi (5%) iniziano in orario. La concentrazione maggiore √® alle 8:00 (104 casi) ma tutti in ritardo, suggerendo che il problema non √® l'orario ma il sistema organizzativo che precede l'avvio.</p>
                    
                    <h4 style="color: #f39c12; margin: 20px 0 15px;">Cascade Effect</h4>
                    <p><strong>Effetto Domino:</strong> Il ritardo del primo intervento (98 min medi) si propaga sull'intera giornata. Con turn-over di 33 min vs standard 15-20, ogni ritardo iniziale viene amplificato del +65% durante la giornata operatoria.</p>
                    
                    <h4 style="color: #9b59b6; margin: 20px 0 15px;">Pattern Specialit√†</h4>
                    <p><strong>Sistematicit√† del Problema:</strong> Nessuna specialit√† sotto 90% ritardi (ORL 100%, GINECOLOGIA 97%, CHIRURGIA 96%) dimostra che il problema √® infrastrutturale, non dipendente dalle singole √©quipe mediche.</p>
                    
                    <h4 style="color: #27ae60; margin: 20px 0 15px;">Impatto Economico</h4>
                    <p><strong>Costo Opportunit√†:</strong> 98 min/giorno √ó 5 giorni = 8.2 ore/settimana di tempo sala perso solo per primi ritardi. Con costo sala ‚Ç¨500/ora stimato = ‚Ç¨4,100/settimana = ‚Ç¨213,000/anno di perdita diretta.</p>
                </div>
            </div>
            
            <!-- Performance per Specialit√† -->
            <div class="section">
                <h2 class="section-title">üè• Performance Timing per Specialit√†</h2>
                <div class="specialita-timing">
                    <div class="specialita-row header">
                        <div>Specialit√†</div>
                        <div>Orario Medio</div>
                        <div>% Ritardi</div>
                        <div>Ritardo Medio</div>
                    </div>
                    <div class="specialita-row">
                        <div class="specialita-name">UROLOGIA</div>
                        <div>11:50</div>
                        <div><span class="timing-badge timing-danger">92%</span></div>
                        <div>104 min</div>
                    </div>
                    <div class="specialita-row">
                        <div class="specialita-name">CHIRURGIA GENERALE</div>
                        <div>11:53</div>
                        <div><span class="timing-badge timing-danger">96%</span></div>
                        <div>107 min</div>
                    </div>
                    <div class="specialita-row">
                        <div class="specialita-name">GINECOLOGIA</div>
                        <div>12:14</div>
                        <div><span class="timing-badge timing-danger">97%</span></div>
                        <div>156 min</div>
                    </div>
                    <div class="specialita-row">
                        <div class="specialita-name">ORTOPEDIA</div>
                        <div>10:51</div>
                        <div><span class="timing-badge timing-danger">94%</span></div>
                        <div>53 min</div>
                    </div>
                    <div class="specialita-row">
                        <div class="specialita-name">ORL</div>
                        <div>10:54</div>
                        <div><span class="timing-badge timing-danger">100%</span></div>
                        <div>28 min</div>
                    </div>
                </div>
            </div>
            
            <!-- Pattern Settimanali -->
            <div class="section">
                <h2 class="section-title">üìÖ Pattern Settimanali</h2>
                <div class="weekly-pattern">
                    <div class="day-card problema">
                        <div class="day-name">LUNED√å</div>
                        <div class="day-stats">
                            <div class="day-stat">Interventi: <span class="value">87</span></div>
                            <div class="day-stat">Ritardi: <span class="value">89%</span></div>
                            <div class="day-stat">Orario medio: <span class="value">11:42</span></div>
                        </div>
                    </div>
                    <div class="day-card problema">
                        <div class="day-name">MARTED√å</div>
                        <div class="day-stats">
                            <div class="day-stat">Interventi: <span class="value">93</span></div>
                            <div class="day-stat">Ritardi: <span class="value">100%</span></div>
                            <div class="day-stat">Orario medio: <span class="value">11:48</span></div>
                        </div>
                    </div>
                    <div class="day-card problema">
                        <div class="day-name">MERCOLED√å</div>
                        <div class="day-stats">
                            <div class="day-stat">Interventi: <span class="value">75</span></div>
                            <div class="day-stat">Ritardi: <span class="value">96%</span></div>
                            <div class="day-stat">Orario medio: <span class="value">11:45</span></div>
                        </div>
                    </div>
                    <div class="day-card problema">
                        <div class="day-name">GIOVED√å</div>
                        <div class="day-stats">
                            <div class="day-stat">Interventi: <span class="value">108</span></div>
                            <div class="day-stat">Ritardi: <span class="value">97%</span></div>
                            <div class="day-stat">Orario medio: <span class="value">11:51</span></div>
                        </div>
                    </div>
                    <div class="day-card problema">
                        <div class="day-name">VENERD√å</div>
                        <div class="day-stats">
                            <div class="day-stat">Interventi: <span class="value">80</span></div>
                            <div class="day-stat">Ritardi: <span class="value">95%</span></div>
                            <div class="day-stat">Orario medio: <span class="value">11:39</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timing Heatmap Analysis -->
            <div class="section">
                <h2 class="section-title">üî• Heatmap Timing Critico</h2>
                
                <!-- Descrizione e Contesto -->
                <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #3498db;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìã Descrizione Analisi</h4>
                    <p style="color: #2c3e50; line-height: 1.6; margin-bottom: 15px;">
                        <strong>La heatmap mostra la percentuale di primi interventi che iniziano in ritardo rispetto alla programmazione delle 8:00, 
                        analizzata per giorno della settimana e fascia oraria effettiva di inizio.</strong>
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.95em;">
                        <div>
                            <strong style="color: #e74c3c;">üéØ Metrica:</strong> % Primi interventi in ritardo<br>
                            <strong style="color: #3498db;">üìä Baseline:</strong> Programmazione ore 8:00<br>
                            <strong style="color: #f39c12;">üìà Campione:</strong> 146 primi interventi/35 giorni
                        </div>
                        <div>
                            <strong style="color: #9b59b6;">üîç Focus:</strong> Pattern sistemici di ritardo<br>
                            <strong style="color: #27ae60;">üí° Obiettivo:</strong> Identificare bottleneck ricorrenti<br>
                            <strong style="color: #e74c3c;">‚ö†Ô∏è Alert:</strong> Zone rosse = criticit√† massima
                        </div>
                    </div>
                </div>
                
                <!-- Chart Container con classe specifica -->
                <div class="heatmap-chart-container" style="
                    background: #f8f9fa;
                    border-radius: 10px;
                    padding: 20px;
                    height: 600px !important;
                    width: 100% !important;
                    max-width: none !important;
                    position: relative;
                    margin: 20px 0;
                ">
                    <canvas id="timingHeatmapChart"></canvas>
                </div>
                
                <!-- Legenda e Interpretazione -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Legenda Colori -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid #3498db;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üé® Legenda Intensit√†</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 20px; background: #8b0000; border-radius: 3px;"></div>
                                <span style="font-weight: 600;">95-100%: CRITICO</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
                                <span style="font-weight: 600;">80-94%: Alto</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 20px; background: #f39c12; border-radius: 3px;"></div>
                                <span style="font-weight: 600;">65-79%: Medio</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 20px; background: #f1c40f; border-radius: 3px;"></div>
                                <span style="font-weight: 600;">50-64%: Basso</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 20px; background: #27ae60; border-radius: 3px;"></div>
                                <span style="font-weight: 600;"><50%: Ottimale</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interpretazione -->
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 5px solid #f39c12;">
                        <h4 style="color: #856404; margin-bottom: 15px;">üìä Pattern Critici Identificati</h4>
                        <div style="color: #856404; line-height: 1.6;">
                            <p style="margin-bottom: 10px;"><strong>üî• EPICENTRO:</strong> Gioved√¨ 10:00-12:00 = 100% ritardi sistematici</p>
                            <p style="margin-bottom: 10px;"><strong>‚ö†Ô∏è MARTED√å:</strong> Giornata pi√π problematica (8:00 e 11:00-12:00)</p>
                            <p style="margin-bottom: 10px;"><strong>‚úÖ VENERD√å PM:</strong> Unica fascia "verde" (13:00 = 55%)</p>
                            <p><strong>üéØ INSIGHT:</strong> Pattern ricorrente 10:00-12:00 = bottleneck sistemico</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Turn-over Analysis -->
            <div class="section">
                <h2 class="section-title">üîÑ Analisi Turn-over tra Interventi</h2>
                <div class="tim
                ing-grid">
                    <div style="display: flex; flex-direction: column; justify-content: center; padding: 40px; text-align: center; background: #f8f9fa; border-radius: 15px;">
                        <div style="font-size: 4em; color: #e74c3c; margin-bottom: 20px;">‚è±Ô∏è</div>
                        <div style="font-size: 2.5em; font-weight: 700; color: #2c3e50; margin-bottom: 10px;">33 minuti</div>
                        <div style="color: #666; font-size: 1.1em;">Turn-over medio tra interventi</div>
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; color: #856404;">
                            <strong>Benchmark ottimale: 15-20 minuti</strong><br>
                            Attuale performance: +65% sopra il target
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="timingTurnoverChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Insights Actionable -->
            <div class="section">
                <h2 class="section-title">üí° Insights Critici & Azioni Immediate</h2>
                <div class="insights-grid">
                    <div class="insight-card critical">
                        <div class="insight-icon">üö®</div>
                        <div class="insight-title">Collasso Scheduling</div>
                        <div class="insight-description">
                            95% dei primi interventi inizia in ritardo. Il sistema di programmazione 8:00 √® completamente inefficace.
                        </div>
                    </div>
                    <div class="insight-card critical">
                        <div class="insight-icon">‚è∞</div>
                        <div class="insight-title">Perdita Massiva di Tempo</div>
                        <div class="insight-description">
                            98 minuti di ritardo medio = 1.6 ore perse ogni giorno per prima seduta. Impatto su intera giornata.
                        </div>
                    </div>
                    <div class="insight-card warning">
                        <div class="insight-icon">üîÑ</div>
                        <div class="insight-title">Turn-over Inefficiente</div>
                        <div class="insight-description">
                            33 minuti di turn-over vs. 15-20 standard. Il problema "sanificazione lenta" √® confermato dai dati.
                        </div>
                    </div>
                    <div class="insight-card critical">
                        <div class="insight-icon">üè•</div>
                        <div class="insight-title">Tutte le Specialit√† Coinvolte</div>
                        <div class="insight-description">
                            Nessuna specialit√† sotto il 90% di ritardi. Il problema √® sistemico, non legato a singole √©quipe.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Raccomandazioni -->
            <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h2 style="color: white; border-bottom: 2px solid rgba(255,255,255,0.3);">üéØ Raccomandazioni Immediate</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">1. Riprogrammazione Orari</h3>
                        <p>Spostare inizio programmato a 9:00-9:30 per allinearsi alla realt√† operativa attuale</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">2. Ottimizzazione Turn-over</h3>
                        <p>Implementare team dedicato sanificazione e protocolli standardizzati per ridurre a 20 min</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">3. Monitoraggio Real-time</h3>
                        <p>Sistema di tracking automatico per identificare ritardi e bottleneck in tempo reale</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         SEZIONE 4: INFRASTRUCTURE - COMPLETA
         ========================================== -->
    <div id="infrastructure" class="dashboard-section">
        <div class="dashboard-container">
            <div class="header">
                <h1>üèóÔ∏è Infrastructure & Capacity Analysis</h1>
                <div class="subtitle">DISCREPANZE CRITICHE NELL'ALLOCAZIONE RISORSE</div>
            </div>
            
            <!-- Mapping Alert -->
            <div class="mapping-alert">
                <h2>‚ö†Ô∏è DISCREPANZA INFRASTRUTTURALE RILEVATA</h2>
                <p>I dati operativi mostrano 10 sale attive vs. 7 teoriche documentate nel caso</p>
                <div class="mapping-comparison">
                    <div class="mapping-card">
                        <div class="number">7</div>
                        <div>Sale Teoriche<br>(da documentazione)</div>
                    </div>
                    <div class="mapping-card">
                        <div class="number">10</div>
                        <div>Sale Effettive<br>(da dati operativi)</div>
                    </div>
                    <div class="mapping-card">
                        <div class="number">3</div>
                        <div>Sale Extra<br>(8, 9, 11)</div>
                    </div>
                </div>
            </div>
            
            <!-- Capacity Summary -->
            <div class="section">
                <h2 class="section-title">üìä Summary Utilizzo Capacity</h2>
                <div class="capacity-summary">
                    <div class="capacity-card">
                        <div class="capacity-value">44%</div>
                        <div class="capacity-label">Utilizzo Medio Sale</div>
                    </div>
                    <div class="capacity-card">
                        <div class="capacity-value">3</div>
                        <div class="capacity-label">Sale Alta Utilization</div>
                    </div>
                    <div class="capacity-card">
                        <div class="capacity-value">6</div>
                        <div class="capacity-label">Sale Dedicate</div>
                    </div>
                    <div class="capacity-card">
                        <div class="capacity-value">4</div>
                        <div class="capacity-label">Sale Condivise</div>
                    </div>
                </div>
            </div>
            
            <!-- Sale Performance -->
            <div class="section">
                <h2 class="section-title">üè• Performance Individual Sale</h2>
                <div class="sale-grid">
                    <!-- Sala 4 - Top Performer -->
                    <div class="sala-card alta">
                        <div class="sala-number">4</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">105 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">103%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">3</span></div>
                            <div class="sala-stat">Dominante: <span class="value">UROLOGIA</span></div>
                        </div>
                        <div class="sala-badge badge-prevalente">PREVALENTE</div>
                        <div class="utilization-badge util-alta">SOVRACCARICA</div>
                    </div>
                    
                    <!-- Sala 3 -->
                    <div class="sala-card alta">
                        <div class="sala-number">3</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">84 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">91%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">4</span></div>
                            <div class="sala-stat">Dominante: <span class="value">UROLOGIA</span></div>
                        </div>
                        <div class="sala-badge badge-prevalente">PREVALENTE</div>
                        <div class="utilization-badge util-alta">ALTA</div>
                    </div>
                    
                    <!-- Sala 5 -->
                    <div class="sala-card alta">
                        <div class="sala-number">5</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">75 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">90%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">1</span></div>
                            <div class="sala-stat">Dominante: <span class="value">ORTOPEDIA</span></div>
                        </div>
                        <div class="sala-badge badge-dedicata">DEDICATA</div>
                        <div class="utilization-badge util-alta">ALTA</div>
                    </div>
                    
                    <!-- Sala 2 -->
                    <div class="sala-card media">
                        <div class="sala-number">2</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">67 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">63%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">3</span></div>
                            <div class="sala-stat">Dominante: <span class="value">ORL</span></div>
                        </div>
                        <div class="sala-badge badge-condivisa">CONDIVISA</div>
                        <div class="utilization-badge util-media">MEDIA</div>
                    </div>
                    
                    <!-- Sala 7 -->
                    <div class="sala-card media">
                        <div class="sala-number">7</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">60 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">56%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">1</span></div>
                            <div class="sala-stat">Dominante: <span class="value">GINECOLOGIA</span></div>
                        </div>
                        <div class="sala-badge badge-dedicata">DEDICATA</div>
                        <div class="utilization-badge util-media">MEDIA</div>
                    </div>
                    
                    <!-- Sale Minori -->
                    <div class="sala-card bassa">
                        <div class="sala-number">1</div>
                        <div class="sala-stats">
                            <div class="sala-stat">Volume: <span class="value">26 interventi</span></div>
                            <div class="sala-stat">Utilizzo: <span class="value">30%</span></div>
                            <div class="sala-stat">Specialit√†: <span class="value">2</span></div>
                        </div>
                        <div class="sala-badge badge-condivisa">CONDIVISA</div>
                        <div class="utilization-badge util-bassa">SOTTOUTILIZZATA</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="section">
                <h2 class="section-title">üìà Analisi Capacity & Distribuzione</h2>
                <div class="chart-grid">
                    <div class="chart-container">
                        <canvas id="infraCapacityChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="infraSankeyChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Capacity Bubble Analysis -->
            <div class="section">
                <h2 class="section-title">üí´ Bubble Analysis - Squilibrio Capacity Critico</h2>
                
                <!-- Descrizione Bubble Chart -->
                <div style="background: #fff8e1; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #f39c12;">
                    <h4 style="color: #e67e22; margin-bottom: 15px;">‚öñÔ∏è Squilibrio Infrastructure Sistemico</h4>
                    <p style="color: #e67e22; line-height: 1.6; margin-bottom: 15px;">
                        <strong>Il bubble chart rivela squilibri critici nell'allocazione sale: Sala 4 sovraccarica (103% capacity) mentre 
                        Sale 8-9 quasi inutilizzate (<15%). Dimensione bubble = numero specialit√† per sala.</strong>
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.95em;">
                        <div>
                            <strong style="color: #e74c3c;">üî¥ CRITICIT√Ä:</strong><br>
                            ‚Ä¢ Sala 4: 103% utilizzo<br>
                            ‚Ä¢ 105 interventi concentrati<br>
                            ‚Ä¢ 3 specialit√† sovrapposte
                        </div>
                        <div>
                            <strong style="color: #95a5a6;">‚ö™ SPRECO:</strong><br>
                            ‚Ä¢ Sale 8-9: <15% utilizzo<br>
                            ‚Ä¢ Capacity dormiente<br>
                            ‚Ä¢ Investimenti sottoutilizzati
                        </div>
                        <div>
                            <strong style="color: #27ae60;">‚úÖ TARGET:</strong><br>
                            ‚Ä¢ Utilizzo 70-80% ottimale<br>
                            ‚Ä¢ Load balancing sale<br>
                            ‚Ä¢ +40% capacity disponibile
                        </div>
                    </div>
                </div>
                
                <!-- Bubble Chart Container -->
                <div class="chart-container" style="height: 600px; margin: 20px 0;">
                    <canvas id="infraBubbleChart"></canvas>
                </div>
                
                <!-- Analisi Actionable -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Quick Wins -->
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 5px solid #27ae60;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üöÄ Quick Wins Identificati</h4>
                        <div style="color: #2c3e50; line-height: 1.6; font-size: 0.95em;">
                            <p style="margin-bottom: 10px;"><strong>Redistribuzione immediata:</strong> Sala 4 ‚Üí Sale 1,8,9</p>
                            <p style="margin-bottom: 10px;"><strong>Target realistico:</strong> Sala 4 da 103% a 80% utilizzo</p>
                            <p style="margin-bottom: 10px;"><strong>Activation dormiente:</strong> Sale 8-9 da 1% a 30%</p>
                            <p><strong>ROI:</strong> +40% capacity senza investimenti hardware</p>
                        </div>
                    </div>
                    
                    <!-- Strategic Actions -->
                    <div style="background: #fdf2e9; padding: 20px; border-radius: 10px; border-left: 5px solid #e67e22;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üéØ Azioni Strategiche</h4>
                        <div style="color: #2c3e50; line-height: 1.6; font-size: 0.95em;">
                            <p style="margin-bottom: 10px;"><strong>Mapping completo:</strong> Verificare Sale 8,9,11 "fantasma"</p>
                            <p style="margin-bottom: 10px;"><strong>Load balancing:</strong> Algorithm allocation dinamico</p>
                            <p style="margin-bottom: 10px;"><strong>Specialization model:</strong> Sala dedicata vs condivisa</p>
                            <p><strong>Monitoring:</strong> KPI utilizzo real-time per ottimizzazione</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analisi Approfondita -->
            <div class="section">
                <h2 class="section-title">üîç Analisi Allocation & Optimization</h2>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; line-height: 1.6;">
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">Squilibrio Critico</h4>
                    <p><strong>Concentrazione vs Dispersione:</strong> Le prime 3 sale (4,3,5) gestiscono il 57% del volume totale (264/455 interventi) mentre le ultime 3 sale (9,11,8) solo il 5% (23 interventi). Sala 4 al 103% capacit√† vs Sala 8 all'1% rappresenta il massimo spreco di risorse.</p>
                    
                    <h4 style="color: #f39c12; margin: 20px 0 15px;">Sale "Fantasma" Impact</h4>
                    <p><strong>Discrepanza Documentale:</strong> Sale 8,9,11 operative ma non documentate nel caso rappresentano 23 interventi (5% volume). Questa discrepanza suggerisce problemi di governance e controllo delle risorse infrastrutturali.</p>
                    
                    <h4 style="color: #2c3e50; margin: 20px 0 15px;">Opportunity Cost</h4>
                    <p><strong>Potenziale Non Sfruttato:</strong> Con 44% utilizzo medio vs 75% target, il sistema ha capacit√† per +40% volume (182 interventi aggiuntivi) senza investimenti. Redistribuendo il carico da Sala 4 (-13%) a sale sottoutilizzate (+30% ciascuna), si ottimizza l'intero sistema.</p>
                    
                    <h4 style="color: #9b59b6; margin: 20px 0 15px;">Specialization Strategy</h4>
                    <p><strong>Modello Sala Dedicata:</strong> ORL con sala dedicata (100% Sala 2) mostra coordinamento ottimale. Replicando questo modello per GINECOLOGIA (Sala 7, 72% concentrazione) e consolidando CHIRURGIA da 6 a 2-3 sale, si riduce complessit√† gestionale.</p>
                </div>
            </div>
            
            <!-- Mobility Analysis -->
            <div class="section">
                <h2 class="section-title">üîÑ Cross-Utilization Specialit√†</h2>
                <table class="mobility-table">
                    <thead>
                        <tr>
                            <th>Specialit√†</th>
                            <th>Sale Utilizzate</th>
                            <th>Sala Principale</th>
                            <th>Concentrazione</th>
                            <th>Mobility</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ORTOPEDIA & TRAUMATOLOGIA</strong></td>
                            <td>5</td>
                            <td>Sala 5</td>
                            <td>72%</td>
                            <td><span class="mobility-badge mobility-alta">ALTA</span></td>
                        </tr>
                        <tr>
                            <td><strong>CHIRURGIA GENERALE</strong></td>
                            <td>6</td>
                            <td>Sala 8</td>
                            <td>51%</td>
                            <td><span class="mobility-badge mobility-alta">ALTA</span></td>
                        </tr>
                        <tr>
                            <td><strong>UROLOGIA</strong></td>
                            <td>4</td>
                            <td>Sala 4</td>
                            <td>43%</td>
                            <td><span class="mobility-badge mobility-alta">ALTA</span></td>
                        </tr>
                        <tr>
                            <td><strong>GINECOLOGIA</strong></td>
                            <td>3</td>
                            <td>Sala 7</td>
                            <td>72%</td>
                            <td><span class="mobility-badge mobility-media">MEDIA</span></td>
                        </tr>
                        <tr>
                            <td><strong>OTORINOLARINGOIATRIA</strong></td>
                            <td>1</td>
                            <td>Sala 2</td>
                            <td>100%</td>
                            <td><span class="mobility-badge mobility-bassa">BASSA</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Insights -->
            <div class="section">
                <h2 class="section-title">üí° Infrastructure Insights</h2>
                <div class="insights-grid">
                    <div class="insight-card warning">
                        <div class="insight-icon">üèóÔ∏è</div>
                        <div class="insight-title">Sale "Fantasma"</div>
                        <div class="insight-description">
                            3 sale operative (8,9,11) non documentate nel caso. Necessaria ricognizione infrastructure completa.
                        </div>
                    </div>
                    <div class="insight-card critical">
                        <div class="insight-icon">‚öñÔ∏è</div>
                        <div class="insight-title">Squilibrio Utilizzo</div>
                        <div class="insight-description">
                            Sala 4 sovraccarica (103%) mentre Sala 8,9 sottoutilizzate (<15%). Redistribuzione necessaria.
                        </div>
                    </div>
                    <div class="insight-card warning">
                        <div class="insight-icon">üîÑ</div>
                        <div class="insight-title">Alta Mobility</div>
                        <div class="insight-description">
                            3 specialit√† usano 4+ sale. Coordinamento complesso e potenziali inefficienze scheduling.
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">üìä</div>
                        <div class="insight-title">Capacity Sottoutilizzata</div>
                        <div class="insight-description">
                            44% utilizzo medio vs. target 70-80%. Potenziale per +40% volume senza nuove risorse.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Raccomandazioni -->
            <div class="section" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white;">
                <h2 style="color: white; border-bottom: 2px solid rgba(255,255,255,0.3);">üéØ Raccomandazioni Infrastructure</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">1. Mapping Completo</h3>
                        <p>Ricognizione fisica sale 8,9,11 e aggiornamento documentazione infrastructure</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">2. Rebalancing Carico</h3>
                        <p>Redistribuire volume da Sala 4 (103%) verso sale sottoutilizzate</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">3. Standardizzazione Utilizzo</h3>
                        <p>Definire allocation policy per specialit√† multi-sala e ridurre mobility inefficiente</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         SEZIONE 5: SPECIALIT√Ä ANALYSIS - COMPLETA
         ========================================== -->
    <div id="specialita" class="dashboard-section">
        <div class="dashboard-container">
            <div class="header">
                <h1>üè• Specialit√† Deep Dive Analysis</h1>
                <div class="subtitle">VARIABILIT√Ä CRITICA E FRAMMENTAZIONE SISTEMICA</div>
            </div>
            
            <!-- Critical Findings -->
            <div class="critical-findings">
                <h2>üö® FINDINGS CRITICI SPECIALIT√Ä</h2>
                <p>Sistema caratterizzato da alta variabilit√†, frammentazione sale e inefficienze organizzative</p>
                <div class="findings-grid">
                    <div class="finding-card">
                        <div class="finding-value">76%</div>
                        <div>Variabilit√† UROLOGIA<br>(Target: <30%)</div>
                    </div>
                    <div class="finding-card">
                        <div class="finding-value">4/5</div>
                        <div>Specialit√† con<br>Alta Variabilit√†</div>
                    </div>
                    <div class="finding-card">
                        <div class="finding-value">6</div>
                        <div>Sale utilizzate da<br>CHIRURGIA GENERALE</div>
                    </div>
                    <div class="finding-card">
                        <div class="finding-value">1/5</div>
                        <div>Specialit√† con<br>Sala Dedicata</div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Overview per Specialit√† -->
            <div class="section">
                <h2 class="section-title">üìä Performance Overview Specialit√†</h2>
                <div class="specialita-grid">
                    <!-- UROLOGIA -->
                    <div class="specialita-card media-priorita">
                        <div class="priority-badge priority-media">MEDIA</div>
                        <div class="specialita-name">UROLOGIA</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">156</div>
                                <div class="metric-label">Interventi (34%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">91¬±69</div>
                                <div class="metric-label">Minuti (CV: 76%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">126%</div>
                                <div class="metric-label">Efficienza</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">4</div>
                                <div class="metric-label">Sale Utilizzate</div>
                            </div>
                        </div>
                        <div class="problemi-list">
                            <span class="problema-tag">Alta variabilit√† tempi</span>
                            <span class="problema-tag">Frammentazione sale</span>
                        </div>
                        <div>
                            <span class="opportunita-tag">Alta efficienza</span>
                            <span class="opportunita-tag">Programmazione stabile</span>
                        </div>
                    </div>
                    
                    <!-- ORTOPEDIA -->
                    <div class="specialita-card media-priorita">
                        <div class="priority-badge priority-media">MEDIA</div>
                        <div class="specialita-name">ORTOPEDIA & TRAUMATOLOGIA</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">104</div>
                                <div class="metric-label">Interventi (23%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">101¬±42</div>
                                <div class="metric-label">Minuti (CV: 42%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">100%</div>
                                <div class="metric-label">Efficienza</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">5</div>
                                <div class="metric-label">Sale Utilizzate</div>
                            </div>
                        </div>
                        <div class="problemi-list">
                            <span class="problema-tag">Frammentazione sale</span>
                        </div>
                        <div>
                            <span class="opportunita-tag">Alta efficienza</span>
                            <span class="opportunita-tag">Variabilit√† migliore</span>
                        </div>
                    </div>
                    
                    <!-- GINECOLOGIA -->
                    <div class="specialita-card media-priorita">
                        <div class="priority-badge priority-media">MEDIA</div>
                        <div class="specialita-name">GINECOLOGIA</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">83</div>
                                <div class="metric-label">Interventi (18%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">81¬±50</div>
                                <div class="metric-label">Minuti (CV: 62%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">129%</div>
                                <div class="metric-label">Efficienza</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">3</div>
                                <div class="metric-label">Sale Utilizzate</div>
                            </div>
                        </div>
                        <div class="problemi-list">
                            <span class="problema-tag">Alta variabilit√† tempi</span>
                        </div>
                        <div>
                            <span class="opportunita-tag">Alta efficienza</span>
                            <span class="opportunita-tag">Tempi medi bassi</span>
                        </div>
                    </div>
                    
                    <!-- CHIRURGIA GENERALE -->
                    <div class="specialita-card alta-priorita">
                        <div class="priority-badge priority-alta">ALTA</div>
                        <div class="specialita-name">CHIRURGIA GENERALE</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">73</div>
                                <div class="metric-label">Interventi (16%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">91¬±47</div>
                                <div class="metric-label">Minuti (CV: 52%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">130%</div>
                                <div class="metric-label">Efficienza</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">6</div>
                                <div class="metric-label">Sale Utilizzate</div>
                            </div>
                        </div>
                        <div class="problemi-list">
                            <span class="problema-tag">Alta variabilit√† tempi</span>
                            <span class="problema-tag">Tasso urgenze elevato</span>
                            <span class="problema-tag">Frammentazione sale</span>
                        </div>
                        <div>
                            <span class="opportunita-tag">Alta efficienza</span>
                        </div>
                    </div>
                    
                    <!-- ORL -->
                    <div class="specialita-card media-priorita">
                        <div class="priority-badge priority-media">MEDIA</div>
                        <div class="specialita-name">OTORINOLARINGOIATRIA</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">39</div>
                                <div class="metric-label">Interventi (9%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">82¬±51</div>
                                <div class="metric-label">Minuti (CV: 62%)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">100%</div>
                                <div class="metric-label">Efficienza</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">1</div>
                                <div class="metric-label">Sale Utilizzate</div>
                            </div>
                        </div>
                        <div class="problemi-list">
                            <span class="problema-tag">Alta variabilit√† tempi</span>
                        </div>
                        <div>
                            <span class="opportunita-tag">Alta efficienza</span>
                            <span class="opportunita-tag">Sala dedicata</span>
                            <span class="opportunita-tag">Programmazione stabile</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Charts Analysis -->
            <div class="section">
                <h2 class="section-title">üìà Analisi Performance Cross-Specialit√†</h2>
                <div class="chart-grid">
                    <div class="chart-container">
                        <canvas id="specVariabilitaChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="specCaseMixChart"></canvas>
                    </div>
                </div>
            </div>
            <!-- Variability Box Plot Analysis -->
            <div class="section">
                <h2 class="section-title">üì¶ Analisi Variabilit√† - Box Plot Critico</h2>
                
                <!-- Descrizione Box Plot -->
                <div style="background: #fff5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #e74c3c;">
                    <h4 style="color: #c0392b; margin-bottom: 15px;">‚ö†Ô∏è Alert Variabilit√† Critica</h4>
                    <p style="color: #c0392b; line-height: 1.6; margin-bottom: 15px;">
                        <strong>Il box plot evidenzia la distribuzione dei tempi operatori per specialit√†, con focus sulla variabilit√† eccessiva di UROLOGIA (76% CV) 
                        rispetto al target operativo del 30% CV per programmazione affidabile.</strong>
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.95em;">
                        <div>
                            <strong style="color: #e74c3c;">üìä Metrica:</strong> Distribuzione tempi intervento (min)<br>
                            <strong style="color: #9b59b6;">üéØ Target CV:</strong> <30% per programmazione affidabile<br>
                            <strong style="color: #f39c12;">üìà Problema:</strong> UROLOGIA 76% CV = 2.5x oltre limite
                        </div>
                        <div>
                            <strong style="color: #27ae60;">üèÜ Best Practice:</strong> ORTOPEDIA 42% CV<br>
                            <strong style="color: #3498db;">üîç Outliers:</strong> Interventi anomali da standardizzare<br>
                            <strong style="color: #2c3e50;">üí° Azione:</strong> Protocolli UROLOGIA prioritari
                        </div>
                    </div>
                </div>
                
                <!-- Box Plot Chart Container -->
                <div class="chart-container" style="height: 500px; margin: 20px 0;">
                    <canvas id="specialitaBoxPlotChart"></canvas>
                </div>
                
                <!-- Interpretazione Risultati -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <!-- Analisi Critica -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid #e74c3c;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üö® Criticit√† Identificate</h4>
                        <div style="color: #2c3e50; line-height: 1.6; font-size: 0.95em;">
                            <p style="margin-bottom: 10px;"><strong>UROLOGIA:</strong> Range 22-160 min (76% CV) = programmazione impossibile</p>
                            <p style="margin-bottom: 10px;"><strong>GINECOLOGIA:</strong> 62% CV = seconda pi√π variabile</p>
                            <p style="margin-bottom: 10px;"><strong>CHIRURGIA:</strong> 52% CV + 6 sale = complessit√† massima</p>
                            <p><strong>Impatto:</strong> Sistema scheduling compromesso su 4/5 specialit√†</p>
                        </div>
                    </div>
                    
                    <!-- Best Practices -->
                    <div style="background: #f0f8f0; padding: 20px; border-radius: 10px; border-left: 5px solid #27ae60;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">‚úÖ Modelli Replicabili</h4>
                        <div style="color: #2c3e50; line-height: 1.6; font-size: 0.95em;">
                            <p style="margin-bottom: 10px;"><strong>ORTOPEDIA:</strong> 42% CV = migliore controllo variabilit√†</p>
                            <p style="margin-bottom: 10px;"><strong>Protocolli standardizzati:</strong> Tempi pi√π prevedibili</p>
                            <p style="margin-bottom: 10px;"><strong>Target raggiungibile:</strong> Riduzione CV a <40% fattibile</p>
                            <p><strong>ROI:</strong> Programmazione accurata = +15% efficiency planning</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analisi Approfondita -->
            <div class="section">
                <h2 class="section-title">üî¨ Analisi Performance & Variabilit√†</h2>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; line-height: 1.6;">
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">Variabilit√† Critica</h4>
                    <p><strong>UROLOGIA (76% CV):</strong> Leader di volume (156 interventi, 34%) ma worst performer in variabilit√†. Range 91¬±69 min significa interventi da 22 a 160 minuti, rendendo programmazione accurata impossibile. Urgente standardizzazione protocolli per specialit√† chiave.</p>
                    
                    <h4 style="color: #27ae60; margin: 20px 0 15px;">Best Practice: ORTOPEDIA</h4>
                    <p><strong>Modello di Riferimento (42% CV):</strong> Migliore bilanciamento volume/variabilit√†. Pur usando 5 sale, mantiene controllo operativo. Tempi 101¬±42 min pi√π prevedibili permettono scheduling efficace. Protocolli replicabili per altre specialit√†.</p>
                    
                    <h4 style="color: #f39c12; margin: 20px 0 15px;">CHIRURGIA: Priorit√† Alta</h4>
                    <p><strong>Frammentazione Massima:</strong> Unica specialit√† "Alta Priorit√†" per convergenza di fattori critici: 6 sale utilizzate, 52% variabilit√†, 22% tasso urgenze (vs 3-13% altre). Consolidamento su 2-3 sale dedicate ridurrebbe coordinamento esponenziale.</p>
                    
                    <h4 style="color: #3498db; margin: 20px 0 15px;">Efficiency Paradox</h4>
                    <p><strong>Sottostima Sistemica:</strong> Tutte specialit√† >100% efficienza nonostante alta variabilit√† indica tempi programmati cronicamente sottostimati. Non problema di performance medica ma di sistema gestionale che non incorpora variabilit√† reale.</p>
                    
                    <h4 style="color: #9b59b6; margin: 20px 0 15px;">Weekly Patterns</h4>
                    <p><strong>Distribuzione Asimmetrica:</strong> UROLOGIA picco gioved√¨ (50 vs 13-34 altri giorni), CHIRURGIA concentrata luned√¨ (32). Pattern suggeriscono preferenze organizzative piuttosto che cliniche, creando bottleneck prevedibili.</p>
                </div>
            </div>
            
            <!-- Benchmark Table -->
            <div class="section">
                <h2 class="section-title">üèÜ Benchmarking Specialit√†</h2>
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Specialit√†</th>
                            <th>Volume</th>
                            <th>Tempo Medio</th>
                            <th>Variabilit√†</th>
                            <th>Efficienza</th>
                            <th>Sale</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>UROLOGIA</strong></td>
                            <td>156 (34%)</td>
                            <td>91 min</td>
                            <td>76% CV</td>
                            <td>126%</td>
                            <td>4</td>
                            <td><span class="performance-indicator perf-good"></span>Leader Volume</td>
                        </tr>
                        <tr>
                            <td><strong>ORTOPEDIA</strong></td>
                            <td>104 (23%)</td>
                            <td>101 min</td>
                            <td>42% CV</td>
                            <td>100%</td>
                            <td>5</td>
                            <td><span class="performance-indicator perf-excellent"></span>Best Variabilit√†</td>
                        </tr>
                        <tr>
                            <td><strong>GINECOLOGIA</strong></td>
                            <td>83 (18%)</td>
                            <td>81 min</td>
                            <td>62% CV</td>
                            <td>129%</td>
                            <td>3</td>
                            <td><span class="performance-indicator perf-good"></span>Tempo Minimo</td>
                        </tr>
                        <tr>
                            <td><strong>CHIRURGIA GEN.</strong></td>
                            <td>73 (16%)</td>
                            <td>91 min</td>
                            <td>52% CV</td>
                            <td>130%</td>
                            <td>6</td>
                            <td><span class="performance-indicator perf-excellent"></span>Max Efficienza</td>
                        </tr>
                        <tr>
                            <td><strong>ORL</strong></td>
                            <td>39 (9%)</td>
                            <td>82 min</td>
                            <td>62% CV</td>
                            <td>100%</td>
                            <td>1</td>
                            <td><span class="performance-indicator perf-excellent"></span>Sala Dedicata</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Weekly Patterns Heatmap -->
            <div class="section">
                <h2 class="section-title">üìÖ Pattern Settimanali per Specialit√†</h2>
                <div class="weekly-heatmap">
                    <div class="heatmap-cell heatmap-header">Specialit√†</div>
                    <div class="heatmap-cell heatmap-header">LUN</div>
                    <div class="heatmap-cell heatmap-header">MAR</div>
                    <div class="heatmap-cell heatmap-header">MER</div>
                    <div class="heatmap-cell heatmap-header">GIO</div>
                    <div class="heatmap-cell heatmap-header">VEN</div>
                    
                    <div class="heatmap-cell heatmap-header">UROLOGIA</div>
                    <div class="heatmap-cell heatmap-medium">34</div>
                    <div class="heatmap-cell heatmap-medium">28</div>
                    <div class="heatmap-cell heatmap-low">13</div>
                    <div class="heatmap-cell heatmap-high">50</div>
                    <div class="heatmap-cell heatmap-medium">22</div>
                    
                    <div class="heatmap-cell heatmap-header">ORTOPEDIA</div>
                    <div class="heatmap-cell heatmap-high">39</div>
                    <div class="heatmap-cell heatmap-medium">25</div>
                    <div class="heatmap-cell heatmap-medium">19</div>
                    <div class="heatmap-cell heatmap-low">14</div>
                    <div class="heatmap-cell heatmap-medium">18</div>
                    
                    <div class="heatmap-cell heatmap-header">GINECOLOGIA</div>
                    <div class="heatmap-cell heatmap-low">2</div>
                    <div class="heatmap-cell heatmap-medium">20</div>
                    <div class="heatmap-cell heatmap-high">25</div>
                    <div class="heatmap-cell heatmap-medium">15</div>
                    <div class="heatmap-cell heatmap-medium">12</div>
                    
                    <div class="heatmap-cell heatmap-header">CHIRURGIA</div>
                    <div class="heatmap-cell heatmap-high">32</div>
                    <div class="heatmap-cell heatmap-low">2</div>
                    <div class="heatmap-cell heatmap-medium">18</div>
                    <div class="heatmap-cell heatmap-medium">15</div>
                    <div class="heatmap-cell heatmap-medium">15</div>
                    
                    <div class="heatmap-cell heatmap-header">ORL</div>
                    <div class="heatmap-cell heatmap-low">0</div>
                    <div class="heatmap-cell heatmap-medium">8</div>
                    <div class="heatmap-cell heatmap-low">3</div>
                    <div class="heatmap-cell heatmap-high">20</div>
                    <div class="heatmap-cell heatmap-medium">8</div>
                </div>
            </div>
            
            <!-- Strategic Insights -->
            <div class="section">
                <h2 class="section-title">üí° Strategic Insights & Actions</h2>
                <div class="insights-grid">
                    <div class="insight-card critical">
                        <div class="insight-icon">‚ö†Ô∏è</div>
                        <div class="insight-title">Variabilit√† Sistemica</div>
                        <div class="insight-description">
                            4/5 specialit√† oltre soglia critica (50% CV). UROLOGIA worst performer (76%). Standardizzazione urgente.
                        </div>
                    </div>
                    <div class="insight-card warning">
                        <div class="insight-icon">üîÄ</div>
                        <div class="insight-title">Frammentazione Sale</div>
                        <div class="insight-description">
                            CHIRURGIA su 6 sale, ORTOPEDIA su 5. Solo ORL modello "dedicata". Consolidamento necessario.
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon">üìä</div>
                        <div class="insight-title">Efficiency Paradox</div>
                        <div class="insight-description">
                            Tutte >100% efficienza MA alta variabilit√†. Tempi programmati sottostimati sistematicamente.
                        </div>
                    </div>
                    <div class="insight-card critical">
                        <div class="insight-icon">üö®</div>
                        <div class="insight-title">CHIRURGIA Priority</div>
                        <div class="insight-description">
                            Unica specialit√† "Alta Priorit√†": 22% urgenze, 6 sale, variabilit√† 52%. Intervento immediato.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Raccomandazioni -->
            <div class="section" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white;">
                <h2 style="color: white; border-bottom: 2px solid rgba(255,255,255,0.3);">üéØ Raccomandazioni per Specialit√†</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">1. UROLOGIA - Standardizzazione</h3>
                        <p>Protocolli tempi per ridurre CV da 76% a <40%. Focus su volume leader per massimo impatto.</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">2. CHIRURGIA - Consolidamento</h3>
                        <p>Ridurre da 6 a 2-3 sale dedicate. Gestire tasso urgenze (22% vs 3-13% altre).</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="margin-bottom: 15px;">3. ORL - Modello Replicabile</h3>
                        <p>Estendere approccio "sala dedicata" ad altre specialit√† per ridurre frammentazione.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==========================================
         JAVASCRIPT NAVIGATION + CHARTS - UNIFICATO E PULITO
         ========================================== -->
    <script>
        // Navigation function
        function showSection(sectionId) {
            // Nascondi tutte le sezioni
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostra sezione selezionata
            document.getElementById(sectionId).classList.add('active');
            
            // Aggiorna bottoni menu
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // ==========================================
        // NAVIGATION + CHART INITIALIZATION - FIXED
        // ==========================================
        
        // Navigation function
        function showSection(sectionId) {
            // Nascondi tutte le sezioni
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostra sezione selezionata
            document.getElementById(sectionId).classList.add('active');
            
            // Aggiorna bottoni menu
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Forza resize dei chart quando sezione diventa visibile
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 100);
        }

        // Chart instances storage
        let chartInstances = {};

        document.addEventListener('DOMContentLoaded', function() {
            
            // ========== TIMING ANALYSIS CHARTS - FIXED DIMENSIONS ==========
            
            // Timing Ritardi Chart
            const timingRitardiCtx = document.getElementById('timingRitardiChart');
            if (timingRitardiCtx) {
                chartInstances.timingRitardi = new Chart(timingRitardiCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['IN ORARIO (<8:00)', 'RITARDO (>8:00)'],
                        datasets: [{
                            data: [8, 138],
                            backgroundColor: ['#27ae60', '#e74c3c'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.2,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Puntualit√† Primi Interventi - CRISIS LEVEL',
                                font: { size: 16, weight: 'bold' },
                                color: '#e74c3c'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Timing Orari Chart - FIXED SIZE
            const timingOrariCtx = document.getElementById('timingOrariChart');
            if (timingOrariCtx) {
                chartInstances.timingOrari = new Chart(timingOrariCtx, {
                    type: 'bar',
                    data: {
                        labels: ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00+'],
                        datasets: [{
                            label: 'N¬∞ Primi Interventi',
                            data: [3, 104, 9, 9, 1, 2, 18],
                            backgroundColor: [
                                '#27ae60', '#e74c3c', '#e74c3c', '#e74c3c', '#c0392b', '#8e44ad', '#2c3e50'
                            ],
                            borderRadius: 6,
                            maxBarThickness: 40
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Orari Inizio - Sistema 8:00 Fallito',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Numero Primi Interventi'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Orario Effettivo'
                                }
                            }
                        }
                    }
                });
            }

            // Timing Turnover Chart (Ritardi per Specialit√†) - FIXED SIZE  
            const timingTurnoverCtx = document.getElementById('timingTurnoverChart');
            if (timingTurnoverCtx) {
                chartInstances.timingTurnover = new Chart(timingTurnoverCtx, {
                    type: 'bar',
                    data: {
                        labels: ['ORL', 'ORTOPEDIA', 'CHIRURGIA', 'UROLOGIA', 'GINECOLOGIA'],
                        datasets: [{
                            label: '% Ritardi',
                            data: [100, 94, 96, 92, 97],
                            backgroundColor: [
                                '#c0392b', '#e74c3c', '#e74c3c', '#e74c3c', '#e74c3c'
                            ],
                            borderRadius: 6,
                            maxBarThickness: 50
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Ritardi per Specialit√†',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: '% Ritardi'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // ========== INFRASTRUCTURE CHARTS - FORCE VISIBILITY ==========
            
            // Forza visibilit√† temporanea per rendering chart
            const infraSection = document.getElementById('infrastructure');
            const originalDisplay = infraSection.style.display;
            infraSection.style.display = 'block';
            infraSection.style.visibility = 'hidden';
            infraSection.style.position = 'absolute';
            infraSection.style.top = '-9999px';

            // Infrastructure Capacity Chart
            const infraCapacityCtx = document.getElementById('infraCapacityChart');
            if (infraCapacityCtx) {
                chartInstances.infraCapacity = new Chart(infraCapacityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Sala 4', 'Sala 3', 'Sala 5', 'Sala 2', 'Sala 7', 'Sala 6', 'Sala 9', 'Sala 11', 'Sala 1', 'Sala 8'],
                        datasets: [{
                            label: 'Utilizzo %',
                            data: [71, 62, 62, 43, 38, 10, 10, 3, 1, 1],
                            backgroundColor: [
                                '#f39c12', '#f39c12', '#f39c12', '#95a5a6', '#95a5a6', 
                                '#95a5a6', '#95a5a6', '#95a5a6', '#e74c3c', '#e74c3c'
                            ],
                            borderRadius: 6,
                            maxBarThickness: 45
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Capacity Utilization - SQUILIBRIO CRITICO',
                                font: { size: 16, weight: 'bold' },
                                color: '#e74c3c'
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 80,
                                title: {
                                    display: true,
                                    text: 'Utilizzo %'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Infrastructure Volume Chart
            const infraVolumeCtx = document.getElementById('infraVolumeChart');
            if (infraVolumeCtx) {
                chartInstances.infraVolume = new Chart(infraVolumeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Sala 4', 'Sala 3', 'Sala 5', 'Sala 2', 'Sala 7', 'Sale Minori'],
                        datasets: [{
                            data: [105, 84, 75, 67, 60, 64],
                            backgroundColor: [
                                '#e74c3c', '#f39c12', '#27ae60', '#3498db', '#9b59b6', '#95a5a6'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.2,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Volume Interventi - Top 5 Concentrazione',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Ripristina visibilit√† infraSection
            infraSection.style.display = originalDisplay;
            infraSection.style.visibility = '';
            infraSection.style.position = '';
            infraSection.style.top = '';

            // ========== SPECIALIT√Ä CHARTS - FORCE VISIBILITY ==========
            
            // Forza visibilit√† temporanea per rendering chart
            const specSection = document.getElementById('specialita');
            const originalDisplaySpec = specSection.style.display;
            specSection.style.display = 'block';
            specSection.style.visibility = 'hidden';
            specSection.style.position = 'absolute';
            specSection.style.top = '-9999px';

            // Specialit√† Variabilit√† Chart
            const specVariabilitaCtx = document.getElementById('specVariabilitaChart');
            if (specVariabilitaCtx) {
                chartInstances.specVariabilita = new Chart(specVariabilitaCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Specialit√†',
                            data: [
                                {x: 156, y: 76, label: 'UROLOGIA'},
                                {x: 104, y: 41, label: 'ORTOPEDIA'}, 
                                {x: 83, y: 62, label: 'GINECOLOGIA'},
                                {x: 73, y: 52, label: 'CHIRURGIA'},
                                {x: 39, y: 63, label: 'ORL'}
                            ],
                            backgroundColor: [
                                '#e74c3c', '#27ae60', '#e74c3c', '#f39c12', '#e74c3c'
                            ],
                            pointRadius: 10,
                            pointHoverRadius: 14
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.3,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Variabilit√† vs Volume - UROLOGIA Worst',
                                font: { size: 16, weight: 'bold' },
                                color: '#e74c3c'
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const point = context.raw;
                                        return `${point.label}: ${point.x} interventi, ${point.y}% CV`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Volume Interventi'
                                },
                                min: 0,
                                max: 180
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Variabilit√† %'
                                },
                                min: 0,
                                max: 80
                            }
                        }
                    }
                });
            }

            // Specialit√† Case Mix Chart
            const specCaseMixCtx = document.getElementById('specCaseMixChart');
            if (specCaseMixCtx) {
                chartInstances.specCaseMix = new Chart(specCaseMixCtx, {
                    type: 'bar',
                    data: {
                        labels: ['UROLOGIA', 'ORTOPEDIA', 'GINECOLOGIA', 'CHIRURGIA', 'ORL'],
                        datasets: [
                            {
                                label: 'Elezione',
                                data: [79, 86, 76, 68, 85],
                                backgroundColor: '#27ae60',
                                borderRadius: 4,
                                maxBarThickness: 50
                            },
                            {
                                label: 'Urgenza',
                                data: [13, 3, 13, 22, 3],
                                backgroundColor: '#e74c3c',
                                borderRadius: 4,
                                maxBarThickness: 50
                            },
                            {
                                label: 'Altri',
                                data: [8, 11, 11, 10, 12],
                                backgroundColor: '#f39c12',
                                borderRadius: 4,
                                maxBarThickness: 50
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Case Mix - CHIRURGIA 22% Urgenze',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                position: 'bottom'
                            }
                        },
                        scales: {
                            x: {
                                stacked: true
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Ripristina visibilit√† specSection
            specSection.style.display = originalDisplaySpec;
            specSection.style.visibility = '';
            specSection.style.position = '';
            specSection.style.top = '';

            // ========== OVERVIEW & EXECUTIVE CHARTS ==========
            
            // Executive Timeline Chart
            const execTimelineCtx = document.getElementById('execTimelineChart');
            if (execTimelineCtx) {
                chartInstances.execTimeline = new Chart(execTimelineCtx, {
                    type: 'bar',
                    data: {
                        labels: [
                            'Timing Sistemico',
                            'Infrastructure Rebalancing', 
                            'Specialit√† Consolidamento',
                            'Turn-over Optimization',
                            'Standardizzazione Specialit√†'
                        ],
                        datasets: [{
                            label: 'Settimane',
                            data: [2, 4, 12, 4, 16],
                            backgroundColor: [
                                '#e74c3c', '#f39c12', '#f1c40f', '#3498db', '#9b59b6'
                            ],
                            borderRadius: 8,
                            maxBarThickness: 60
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 2,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Timeline Implementazione (Settimane)',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Settimane'
                                }
                            }
                        }
                    }
                });
            }

            // Overview Specialit√† Chart
            const overviewSpecialitaCtx = document.getElementById('overviewSpecialitaChart');
            if (overviewSpecialitaCtx) {
                chartInstances.overviewSpecialita = new Chart(overviewSpecialitaCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['UROLOGIA', 'ORTOPEDIA', 'GINECOLOGIA', 'CHIRURGIA G.', 'ORL'],
                        datasets: [{
                            data: [156, 104, 83, 73, 39],
                            backgroundColor: [
                                '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.2,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Distribuzione per Specialit√†',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }

            // Overview Tipo Intervento Chart
            const overviewTipoCtx = document.getElementById('overviewTipoInterventoChart');
            if (overviewTipoCtx) {
                chartInstances.overviewTipo = new Chart(overviewTipoCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Elezione', 'Urgenza', 'Lib. Prof.', 'Urg. Diff.'],
                        datasets: [{
                            label: 'N¬∞ Interventi',
                            data: [331, 51, 44, 29],
                            backgroundColor: [
                                '#27ae60', '#e74c3c', '#f39c12', '#9b59b6'
                            ],
                            borderRadius: 6,
                            maxBarThickness: 70
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Tipologia Interventi',
                                font: { size: 16, weight: 'bold' }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        // MEDIUM PRIORITY 1: Box Plot Variabilit√† Specialit√†
        const specialitaBoxPlotCtx = document.getElementById('specialitaBoxPlotChart');
            if (specialitaBoxPlotCtx) {
                // Dati box plot per ogni specialit√† (quartili, mediana, outliers)
                const boxPlotData = [
                    {
                        name: 'UROLOGIA',
                        x: 0,
                        cv: 76,
                        median: 91,
                        q1: 60,
                        q3: 130,
                        min: 22,
                        max: 160,
                        outliers: [15, 180, 195], // outliers estremi
                        color: '#e74c3c', // rosso per criticit√†
                        volume: 156
                    },
                    {
                        name: 'GINECOLOGIA',
                        x: 1,
                        cv: 62,
                        median: 81,
                        q1: 55,
                        q3: 110,
                        min: 30,
                        max: 140,
                        outliers: [25, 155],
                        color: '#f39c12', // arancione
                        volume: 83
                    },
                    {
                        name: 'ORL',
                        x: 2,
                        cv: 62,
                        median: 82,
                        q1: 58,
                        q3: 105,
                        min: 35,
                        max: 130,
                        outliers: [28, 145],
                        color: '#f1c40f', // giallo
                        volume: 39
                    },
                    {
                        name: 'CHIRURGIA',
                        x: 3,
                        cv: 52,
                        median: 91,
                        q1: 65,
                        q3: 115,
                        min: 40,
                        max: 135,
                        outliers: [30, 150],
                        color: '#3498db', // blu
                        volume: 73
                    },
                    {
                        name: 'ORTOPEDIA',
                        x: 4,
                        cv: 42,
                        median: 101,
                        q1: 78,
                        q3: 125,
                        min: 55,
                        max: 140,
                        outliers: [45, 155],
                        color: '#27ae60', // verde per best practice
                        volume: 104
                    }
                ];

                // Prepara datasets per Chart.js
                const datasets = [];

                // Dataset per le box (Q1-Q3)
                datasets.push({
                    label: 'Range Interquartile (Q1-Q3)',
                    type: 'bar',
                    data: boxPlotData.map(d => ({
                        x: d.x,
                        y: d.q3 - d.q1,
                        base: d.q1,
                        specialty: d.name,
                        cv: d.cv,
                        median: d.median,
                        q1: d.q1,
                        q3: d.q3
                    })),
                    backgroundColor: boxPlotData.map(d => d.color + '40'), // semi-trasparente
                    borderColor: boxPlotData.map(d => d.color),
                    borderWidth: 2,
                    maxBarThickness: 60
                });

                // Dataset per le mediane
                datasets.push({
                    label: 'Mediana',
                    type: 'scatter',
                    data: boxPlotData.map(d => ({
                        x: d.x,
                        y: d.median,
                        specialty: d.name,
                        cv: d.cv
                    })),
                    backgroundColor: '#2c3e50',
                    borderColor: '#2c3e50',
                    borderWidth: 3,
                    pointRadius: 8,
                    pointStyle: 'line'
                });

                // Dataset per whiskers (min-max)
                const whiskerData = [];
                boxPlotData.forEach(d => {
                    // Whisker inferiore
                    whiskerData.push({x: d.x, y: d.min, type: 'whisker', specialty: d.name});
                    whiskerData.push({x: d.x, y: d.q1, type: 'whisker', specialty: d.name});
                    // Whisker superiore  
                    whiskerData.push({x: d.x, y: d.q3, type: 'whisker', specialty: d.name});
                    whiskerData.push({x: d.x, y: d.max, type: 'whisker', specialty: d.name});
                });

                datasets.push({
                    label: 'Whiskers (Min-Max)',
                    type: 'line',
                    data: whiskerData,
                    backgroundColor: 'transparent',
                    borderColor: '#34495e',
                    borderWidth: 2,
                    pointRadius: 3,
                    pointBackgroundColor: '#34495e',
                    showLine: false,
                    spanGaps: false
                });

                // Dataset per outliers
                const outlierData = [];
                boxPlotData.forEach(d => {
                    d.outliers.forEach(outlier => {
                        outlierData.push({
                            x: d.x,
                            y: outlier,
                            specialty: d.name,
                            cv: d.cv,
                            outlierValue: outlier
                        });
                    });
                });

                datasets.push({
                    label: 'Outliers',
                    type: 'scatter',
                    data: outlierData,
                    backgroundColor: '#e74c3c',
                    borderColor: '#c0392b',
                    borderWidth: 2,
                    pointRadius: 6,
                    pointStyle: 'circle'
                });

                chartInstances.specialitaBoxPlot = new Chart(specialitaBoxPlotCtx, {
                    type: 'bar',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Distribuzione Tempi Operatori - UROLOGIA Critica (76% CV)',
                                font: { size: 18, weight: 'bold' },
                                color: '#e74c3c',
                                padding: { bottom: 30 }
                            },
                            legend: {
                                position: 'bottom',
                                labels: {
                                    filter: function(item) {
                                        return item.text !== 'Whiskers (Min-Max)'; // nasconde whiskers dalla legenda
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.9)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: '#3498db',
                                borderWidth: 2,
                                cornerRadius: 8,
                                callbacks: {
                                    title: function(context) {
                                        const point = context[0];
                                        return point.raw.specialty || boxPlotData[point.parsed.x].name;
                                    },
                                    label: function(context) {
                                        const point = context.raw;
                                        const specialty = boxPlotData[context.parsed.x];
                                        
                                        if (context.datasetIndex === 0) { // Box
                                            return [
                                                `Variabilit√†: ${specialty.cv}% CV`,
                                                `Q3 (75%): ${specialty.q3} min`,
                                                `Mediana: ${specialty.median} min`, 
                                                `Q1 (25%): ${specialty.q1} min`,
                                                `Range: ${specialty.max - specialty.min} min`
                                            ];
                                        } else if (context.datasetIndex === 1) { // Mediana
                                            return `Mediana: ${point.y} min (CV: ${point.cv}%)`;
                                        } else if (context.datasetIndex === 3) { // Outliers
                                            return `Outlier: ${point.outlierValue} min - Caso anomalo`;
                                        }
                                        return `Valore: ${point.y} min`;
                                    },
                                    afterLabel: function(context) {
                                        if (context.datasetIndex === 0) {
                                            const cv = boxPlotData[context.parsed.x].cv;
                                            if (cv >= 70) return 'üî• CRITICO: CV > 70%';
                                            if (cv >= 50) return '‚ö†Ô∏è ALTO: CV > 50%';
                                            if (cv >= 40) return 'üü° MEDIO: CV > 40%';
                                            return '‚úÖ ACCETTABILE: CV < 40%';
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                min: -0.5,
                                max: 4.5,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        return boxPlotData[value]?.name || '';
                                    },
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50'
                                },
                                title: {
                                    display: true,
                                    text: 'SPECIALIT√Ä',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 200,
                                ticks: {
                                    callback: function(value) {
                                        return value + ' min';
                                    },
                                    font: {
                                        size: 12
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'TEMPO OPERATORIO (minuti)',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50'
                                },
                                grid: {
                                    color: '#ecf0f1'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }
            // TODO: Mancano i label per ogni colonna...
        }); // Fine DOMContentLoaded

        // ========== HIGH PRIORITY CHARTS - MODULAR ADDITIONS ==========
            
            // 1. EXECUTIVE: ROI Waterfall Chart
            const execWaterfallCtx = document.getElementById('execWaterfallChart');
            if (execWaterfallCtx) {
                chartInstances.execWaterfall = new Chart(execWaterfallCtx, {
                    type: 'bar',
                    data: {
                        labels: [
                            'Situazione Attuale',
                            'Timing Fix', 
                            'Infrastructure',
                            'Specialit√†',
                            'Turn-over',
                            'ROI Totale'
                        ],
                        datasets: [{
                            label: 'ROI Impact (%)',
                            data: [44, 15, 10, 8, 7, 84], // 44% base + incrementi = 84% finale
                            backgroundColor: [
                                '#e74c3c', // situazione attuale (negativo)
                                '#27ae60', // timing fix (positivo)
                                '#f39c12', // infrastructure 
                                '#9b59b6', // specialit√†
                                '#3498db', // turn-over
                                '#2ecc71'  // totale finale
                            ],
                            borderRadius: 6,
                            maxBarThickness: 60
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'ROI Waterfall - Capacity Boost Progressivo',
                                font: { size: 16, weight: 'bold' },
                                color: '#27ae60'
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        if (context.dataIndex === 0) {
                                            return `Utilizzo attuale: ${value}%`;
                                        } else if (context.dataIndex === 5) {
                                            return `Utilizzo target: ${value}%`;
                                        } else {
                                            return `Boost: +${value}%`;
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 90,
                                title: {
                                    display: true,
                                    text: 'Capacity Utilization %'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
// 2. TIMING: Heatmap Chart.js - FIXED VERSION
const timingHeatmapCtx = document.getElementById('timingHeatmapChart');
            if (timingHeatmapCtx) {
                // Dati heatmap dinamici - facilmente modificabili
                const heatmapData = [
                    // Luned√¨
                    {day: 0, hour: 0, intensity: 85, dayName: 'LUN', hourName: '8:00'},
                    {day: 0, hour: 1, intensity: 70, dayName: 'LUN', hourName: '9:00'},
                    {day: 0, hour: 2, intensity: 90, dayName: 'LUN', hourName: '10:00'},
                    {day: 0, hour: 3, intensity: 95, dayName: 'LUN', hourName: '11:00'},
                    {day: 0, hour: 4, intensity: 80, dayName: 'LUN', hourName: '12:00'},
                    {day: 0, hour: 5, intensity: 60, dayName: 'LUN', hourName: '13:00'},
                    
                    // Marted√¨
                    {day: 1, hour: 0, intensity: 100, dayName: 'MAR', hourName: '8:00'},
                    {day: 1, hour: 1, intensity: 85, dayName: 'MAR', hourName: '9:00'},
                    {day: 1, hour: 2, intensity: 95, dayName: 'MAR', hourName: '10:00'},
                    {day: 1, hour: 3, intensity: 100, dayName: 'MAR', hourName: '11:00'},
                    {day: 1, hour: 4, intensity: 90, dayName: 'MAR', hourName: '12:00'},
                    {day: 1, hour: 5, intensity: 75, dayName: 'MAR', hourName: '13:00'},
                    
                    // Mercoled√¨
                    {day: 2, hour: 0, intensity: 90, dayName: 'MER', hourName: '8:00'},
                    {day: 2, hour: 1, intensity: 75, dayName: 'MER', hourName: '9:00'},
                    {day: 2, hour: 2, intensity: 85, dayName: 'MER', hourName: '10:00'},
                    {day: 2, hour: 3, intensity: 95, dayName: 'MER', hourName: '11:00'},
                    {day: 2, hour: 4, intensity: 85, dayName: 'MER', hourName: '12:00'},
                    {day: 2, hour: 5, intensity: 70, dayName: 'MER', hourName: '13:00'},
                    
                    // Gioved√¨ (PICCO CRITICO)
                    {day: 3, hour: 0, intensity: 95, dayName: 'GIO', hourName: '8:00'},
                    {day: 3, hour: 1, intensity: 90, dayName: 'GIO', hourName: '9:00'},
                    {day: 3, hour: 2, intensity: 100, dayName: 'GIO', hourName: '10:00'},
                    {day: 3, hour: 3, intensity: 100, dayName: 'GIO', hourName: '11:00'},
                    {day: 3, hour: 4, intensity: 100, dayName: 'GIO', hourName: '12:00'},
                    {day: 3, hour: 5, intensity: 85, dayName: 'GIO', hourName: '13:00'},
                    
                    // Venerd√¨
                    {day: 4, hour: 0, intensity: 80, dayName: 'VEN', hourName: '8:00'},
                    {day: 4, hour: 1, intensity: 65, dayName: 'VEN', hourName: '9:00'},
                    {day: 4, hour: 2, intensity: 85, dayName: 'VEN', hourName: '10:00'},
                    {day: 4, hour: 3, intensity: 90, dayName: 'VEN', hourName: '11:00'},
                    {day: 4, hour: 4, intensity: 75, dayName: 'VEN', hourName: '12:00'},
                    {day: 4, hour: 5, intensity: 55, dayName: 'VEN', hourName: '13:00'}
                ];

                // Funzione per determinare il colore in base all'intensit√†
                function getHeatmapColor(intensity) {
                    if (intensity >= 95) return '#8b0000'; // rosso scuro critico
                    if (intensity >= 85) return '#e74c3c'; // rosso alto
                    if (intensity >= 75) return '#f39c12'; // arancione medio
                    if (intensity >= 65) return '#f1c40f'; // giallo basso
                    return '#27ae60'; // verde ottimale
                }

                chartInstances.timingHeatmap = new Chart(timingHeatmapCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Intensit√† Ritardi (%)',
                            data: heatmapData.map(point => ({
                                x: point.day,
                                y: point.hour,
                                intensity: point.intensity,
                                dayName: point.dayName,
                                hourName: point.hourName
                            })),
                            backgroundColor: heatmapData.map(point => getHeatmapColor(point.intensity)),
                            borderColor: heatmapData.map(point => point.intensity >= 95 ? '#2c3e50' : '#ffffff'),
                            borderWidth: heatmapData.map(point => point.intensity >= 95 ? 4 : 2),
                            pointRadius: 20, // RIDOTTO: era 45, ora 30 per evitare sovrapposizioni
                            pointHoverRadius: 35
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // CAMBIATO: ora usa tutto lo spazio del container
                        layout: {
                            padding: {
                                top: 30,
                                bottom: 30,
                                left: 30,
                                right: 30
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Intensit√† Ritardi per Giorno e Fascia Oraria',
                                font: { size: 18, weight: 'bold' },
                                color: '#2c3e50',
                                padding: { bottom: 30 }
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0,0,0,0.9)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: '#3498db',
                                borderWidth: 2,
                                cornerRadius: 8,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                callbacks: {
                                    title: function(context) {
                                        const point = context[0].raw;
                                        return `${point.dayName} - ${point.hourName}`;
                                    },
                                    label: function(context) {
                                        const point = context.raw;
                                        return `Ritardi: ${point.intensity}%`;
                                    },
                                    afterLabel: function(context) {
                                        const point = context.raw;
                                        if (point.intensity >= 95) {
                                            return 'üî• LIVELLO CRITICO';
                                        } else if (point.intensity >= 85) {
                                            return 'üî¥ Livello Alto';
                                        } else if (point.intensity >= 75) {
                                            return 'üü† Livello Medio';
                                        } else if (point.intensity >= 65) {
                                            return 'üü° Livello Basso';
                                        } else {
                                            return 'üü¢ Livello Ottimale';
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                min: -0.5,
                                max: 4.5,
                                grid: {
                                    display: true,
                                    color: '#bdc3c7',
                                    lineWidth: 2
                                },
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        const giorni = ['LUN', 'MAR', 'MER', 'GIO', 'VEN'];
                                        return giorni[value] || '';
                                    },
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50',
                                    padding: 10
                                },
                                title: {
                                    display: true,
                                    text: 'GIORNO DELLA SETTIMANA',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50',
                                    padding: { top: 15 }
                                }
                            },
                            y: {
                                type: 'linear',
                                min: -0.5,
                                max: 5.5,
                                grid: {
                                    display: true,
                                    color: '#bdc3c7',
                                    lineWidth: 2
                                },
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        const ore = ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00'];
                                        return ore[value] || '';
                                    },
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50',
                                    padding: 10
                                },
                                title: {
                                    display: true,
                                    text: 'FASCIA ORARIA',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    },
                                    color: '#2c3e50',
                                    padding: { bottom: 15 }
                                }
                            }
                        },
                        interaction: {
                            intersect: false
                        },
                        elements: {
                            point: {
                                hoverBorderWidth: 4
                            }
                        }
                    },
                    plugins: [{
                        id: 'heatmapLabels',
                        afterDatasetsDraw: function(chart) {
                            const ctx = chart.ctx;
                            const dataset = chart.data.datasets[0];
                            const meta = chart.getDatasetMeta(0);
                            
                            ctx.save();
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.font = 'bold 12px Arial';
                            
                            meta.data.forEach((point, index) => {
                                const dataPoint = dataset.data[index];
                                const intensity = dataPoint.intensity;
                                
                                // Colore del testo in base all'intensit√†
                                if (intensity >= 85) {
                                    ctx.fillStyle = 'white'; // Testo bianco su sfondo scuro
                                } else {
                                    ctx.fillStyle = '#2c3e50'; // Testo scuro su sfondo chiaro
                                }
                                
                                // Disegna il valore percentuale
                                ctx.fillText(intensity + '%', point.x, point.y);
                            });
                            
                            ctx.restore();
                        }
                    }]
                });
            }
            // TODO: NON CI SONO I LABEL PER RIGA E GIORNO
            // TODO: PERCH√à RIGHE VANNO DALLE 13 ALLE 8???

            // 3. INFRASTRUCTURE: Sankey-style Flow Chart (simulato con stacked bar)
            const infraSankeyCtx = document.getElementById('infraSankeyChart');
            if (infraSankeyCtx) {
                chartInstances.infraSankey = new Chart(infraSankeyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['UROLOGIA', 'ORTOPEDIA', 'GINECOLOGIA', 'CHIRURGIA', 'ORL'],
                        datasets: [
                            {
                                label: 'Sala Principale',
                                data: [67, 72, 72, 51, 100], // % concentrazione sala principale
                                backgroundColor: '#2ecc71',
                                borderRadius: 4,
                                maxBarThickness: 60
                            },
                            {
                                label: 'Sale Secondarie', 
                                data: [33, 28, 28, 49, 0], // % distribuzione altre sale
                                backgroundColor: '#f39c12',
                                borderRadius: 4,
                                maxBarThickness: 60
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.5,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Flussi Specialit√†-Sale - Frammentazione Critica',
                                font: { size: 16, weight: 'bold' },
                                color: '#e74c3c'
                            },
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    afterLabel: function(context) {
                                        const specialita = context.label;
                                        const saleMap = {
                                            'UROLOGIA': '4 sale utilizzate',
                                            'ORTOPEDIA': '5 sale utilizzate', 
                                            'GINECOLOGIA': '3 sale utilizzate',
                                            'CHIRURGIA': '6 sale utilizzate - MAX FRAMMENTAZIONE',
                                            'ORL': '1 sala dedicata - MODELLO OTTIMALE'
                                        };
                                        return saleMap[specialita] || '';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Specialit√†'
                                }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Concentrazione %'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

    </script>
</body>
</html>
